
vlan 4000
   name dns
vlan 4001
   name snmp
vlan 4002
   name dns
vlan 10
   name tenant1-web
vlan 11
   name tenant1-app
vlan 12
   name tenant1-db
vlan 13
   name tenant1-edge
vlan 14
   name tenant1-shared
vlan 15
   name tenant2-web
vlan 16
   name tenant2-app
vlan 17
   name tenant2-db
vlan 18
   name tenant2-edge
vlan 19
   name tenant1-shared

interface Vxlan1
   vxlan source-interface Loopback1
   vxlan controller-client
   vxlan udp-port 4789
   vxlan vlan 10 vni 10010
   vxlan vlan 11 vni 10011
   vxlan vlan 12 vni 10012
   vxlan vlan 13 vni 10013
   vxlan vlan 14 vni 10014
   vxlan vlan 15 vni 10015
   vxlan vlan 16 vni 10016
   vxlan vlan 17 vni 10017
   vxlan vlan 18 vni 10018
   vxlan vlan 19 vni 10019

interface Ethernet1
   description shared-eth0
   switchport mode trunk
interface Ethernet2
   description spine1-eth3
   no switchport
   ip address 10.1.0.9/30

interface Loopback0
   description router-id
   ip address 3.3.3.3/32
interface Loopback1
   description vxlan-source-int
   ip address 33.33.33.33/32

interface Vlan4000
   description backup
   ip address 172.16.20.2/24
   ip virtual-router address 172.16.20.1/24
interface Vlan4001
   description snmp
   ip address 172.16.21.2/24
   ip virtual-router address 172.16.21.1/24
interface Vlan4002
   description dns
   ip address 172.16.22.2/24
   ip virtual-router address 172.16.22.1/24
interface Vlan14
   description tenant1-services
   ip address 10.0.0.6/30
interface Vlan19
   description tenant2-services
   ip address 10.0.0.14/30

ip access-list tenant1-services
   permit tcp 192.168.10.0/24 172.16.20.0/24 eq 443
   permit tcp 192.168.11.0/24 172.16.20.0/24 eq 443
   permit tcp 192.168.12.0/24 172.16.20.0/24 eq 443
   permit udp 192.168.10.0/24 172.16.22.254/32 eq 53
   permit udp 192.168.11.0/24 172.16.22.254/32 eq 53
   permit udp 192.168.12.0/24 172.16.22.254/32 eq 53
   permit udp 192.168.10.0/24 172.16.21.0/24 eq 161 162
   permit udp 192.168.11.0/24 172.16.21.0/24 eq 161 162
   permit udp 192.168.12.0/24 172.16.21.0/24 eq 161 162
ip access-list tenant2-services
   permit tcp 192.168.13.0/24 172.16.20.0/24 eq 443
   permit tcp 192.168.14.0/24 172.16.20.0/24 eq 443
   permit tcp 192.168.15.0/24 172.16.20.0/24 eq 443
   permit udp 192.168.13.0/24 172.16.22.254/32 eq 53
   permit udp 192.168.14.0/24 172.16.22.254/32 eq 53
   permit udp 192.168.15.0/24 172.16.22.254/32 eq 53
   permit udp 192.168.13.0/24 172.16.21.0/24 eq 161 162
   permit udp 192.168.14.0/24 172.16.21.0/24 eq 161 162
   permit udp 192.168.15.0/24 172.16.21.0/24 eq 161 162

router bgp 65003
   router-id 3.3.3.3
   neighbor 10.1.0.10 remote-as 65000
   neighbor 10.1.0.10 route-map shared-egress out
   neighbor 10.0.0.5 remote-as 65002
   neighbor 10.0.0.5 route-map tenant1-services-ingress in
   neighbor 10.0.0.5 route-map shared-egress out
   neighbor 10.0.0.13 remote-as 65002
   neighbor 10.0.0.13 route-map tenant2-services-ingress in
   neighbor 10.0.0.13 route-map shared-egress out
   network 3.3.3.3.3/32
   network 33.33.33.33/32
   network 172.16.20.0/24
   network 172.16.21.0/24
   network 172.16.22.0/24

ip prefix-list shared-egress
   permit 172.16.20.0/24
   permit 172.16.21.0/24
   permit 172.16.22.0/24
ip prefix-list tenant1-services-ingress
   permit 192.168.10.0/24
   permit 192.168.11.0/24
   permit 192.168.12.0/24
ip prefix-list tenant2-services-ingress
   permit 192.168.13.0/24
   permit 192.168.14.0/24
   permit 192.168.15.0/24

route-map shared-egress permit 10
   match ip address prefix-list shared-egress
route-map tenant1-services-ingress permit 10
   match ip address prefix-list tenant1-services-ingress
route-map tenant2-services-ingress permit 10
   match ip address prefix-list tenant2-services-ingress
